<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Puzzle Game</title>
    
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../flowRenderer/flow_pieces_and_tray.css">
    <link rel="stylesheet" href="../flowRenderer/flow_canvas.css">
    <link rel="stylesheet" href="./game_controls.css">
    <link rel="stylesheet" href="./gameLayout.css">
    <link rel="stylesheet" href="./gameFlowRenderer.css">
    <link rel="stylesheet" href="./zoom.css">
    <link rel="stylesheet" href="./toast.css">

    <link rel="icon" type="image/png" href="/favicon.png">
</head>
<body class="flow-app-base">

<header id="game-controls" class="game-controls-cards">
    <div class="game-controls-top">
        <a href="/" class="home-link">
            <img src="/favicon.png" alt="Accueil" class="home-logo">
        </a>
        <h3 class="controls-title">Select Puzzle</h3>
    </div>

    <div id="game-cards" class="game-cards" role="list"></div>

    <div class="hint-container">
        <span class="hint-icon">?</span>
        <span class="hint-text">
            Start with Events, then customer journey: UI/Screens/Automation.
            Arrows will appear when two connected pieces are correctly placed.
        </span>
    </div>
</header>


<div id="app" class="app-layout">
    <main class="main-content">
        <section id="piece-tray" class="piece-tray-styles">
            <h2>Available Pieces</h2>
            <div id="tray-canvas" class="tray-canvas-wrapper">
                <div class="zoom-controls" id="tray-zoom-controls">
                    <button id="tray-zoom-out">−</button>
                    <button id="tray-zoom-reset">⟳</button>
                    <button id="tray-zoom-in">+</button>
                </div>
                <div id="tray-inner"></div>
            </div>
        </section>

        <section id="flow-area" class="flow-area-styles">
            <div class="zoom-controls">
                <button id="zoom-out">−</button>
                <button id="zoom-reset">⟳</button>
                <button id="zoom-in">+</button>
            </div>
            <div id="flow-canvas" class="flow-canvas-wrapper">
                <div id="flow-inner">
                    <div id="grid-container"></div>
                    <svg id="flow-svg"></svg>
                </div>
            </div>
        </section>
    </main>
</div>

<script type="module" src="gameLoader.js"></script>
<script type="module" src="puzzleGuide.js"></script> 
<script type="module" src="../flowRenderer/flowRenderer.js"></script>

<script src="./tray-zoom.js"></script>

<script>
(() => {
    const flowInner = document.getElementById('flow-inner');
    const zoomIn = document.getElementById('zoom-in');
    const zoomOut = document.getElementById('zoom-out');
    const zoomReset = document.getElementById('zoom-reset');
    
    // Duplicated variables removed - use constants defined here
    const minZoom = 0.5;
    const maxZoom = 2.0;
    const step = 0.1;
    let zoomLevel = 1;

    function applyZoom() {
        flowInner.style.transform = `scale(${zoomLevel})`;
    }

    zoomIn.addEventListener('click', () => {
        zoomLevel = Math.min(maxZoom, zoomLevel + step);
        applyZoom();
    });

    zoomOut.addEventListener('click', () => {
        zoomLevel = Math.max(minZoom, zoomLevel - step);
        applyZoom();
    });

    zoomReset.addEventListener('click', () => {
        zoomLevel = 1;
        applyZoom();
    });

    // Optional: wheel zoom on Ctrl + scroll only inside flow-area
    document.getElementById('flow-area').addEventListener('wheel', (e) => {
        if (!e.ctrlKey) return;
        e.preventDefault();
        zoomLevel += e.deltaY > 0 ? -step : step;
        zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));
        applyZoom();
    }, { passive: false });
    
    // Initial application of zoom level
    applyZoom();
})();
</script>

</body>
</html>